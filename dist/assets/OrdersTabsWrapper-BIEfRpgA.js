import{Q as W,u as _,c as q,t as L,S as Q,V as $,j as e,W as X,B as K,X as Z,z as w,Y as J,Z as G,I as ee,r as C,M as ae,G as P,q as S,A as re,$ as se,R as te,l as le,P as oe,k as A,D as I}from"./index-DwXd4TTA.js";import{A as ie}from"./AppTabs-CpeB8z3Y.js";import{c as ne,B as ce,o as M,M as de,D as me}from"./MUIThemeProvider-Upu1qkYL.js";import{u as ue,A as Y,a as H}from"./ApiConstants-B3vWYKSo.js";import{A as pe}from"./AppChipComponent-LPE-MC8O.js";import{c as ye,D as E,I as he,a as fe,L as R,T as be,b as Se,M as N}from"./index-DGJ9ouXy.js";import{c as xe,g as Te,F as ge,h as ve}from"./index.esm-DDE4z3sI.js";import{I as De}from"./IconX-CuwNTDuX.js";import{T as g}from"./Text-BaOLMAxN.js";import{I as Ce,T as b,S as je}from"./IconTrash-Dnpr9U1C.js";import{u as Ee,L as Ie}from"./DateTimePicker-Dn1tq8m7.js";import{C as Ne}from"./Card-DiOYC0em.js";import{A as Fe}from"./Alert-BVxpVNY2.js";import{T as Oe}from"./Title-BfubApG4.js";import"./Rating-BZxZswsB.js";const Pe={gap:{type:"spacing",property:"gap"},rowGap:{type:"spacing",property:"rowGap"},columnGap:{type:"spacing",property:"columnGap"},align:{type:"identity",property:"alignItems"},justify:{type:"identity",property:"justifyContent"},wrap:{type:"identity",property:"flexWrap"},direction:{type:"identity",property:"flexDirection"}};var V={root:"m_8bffd616"};const Me={},k=W((a,s)=>{const t=_("Flex",Me,a),{classNames:r,className:o,style:c,styles:h,unstyled:u,vars:d,gap:m,rowGap:v,columnGap:x,align:T,justify:p,wrap:i,direction:l,...n}=t,f=q({name:"Flex",classes:V,props:t,className:o,style:c,classNames:r,styles:h,unstyled:u,vars:d}),D=L(),j=Q(),y=$({styleProps:{gap:m,rowGap:v,columnGap:x,align:T,justify:p,wrap:i,direction:l},theme:D,data:Pe});return e.jsxs(e.Fragment,{children:[y.hasResponsiveStyles&&e.jsx(X,{selector:`.${j}`,styles:y.styles,media:y.media}),e.jsx(K,{ref:s,...f("root",{className:j,style:Z(y.inlineStyles)}),...n})]})});k.classes=V;k.displayName="@mantine/core/Flex";/**
 * @license @tabler/icons-react v3.21.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Le=w("outline","alert-circle","IconAlertCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 8v4",key:"svg-1"}],["path",{d:"M12 16h.01",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.21.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var we=w("outline","currency-euro","IconCurrencyEuro",[["path",{d:"M17.2 7a6 7 0 1 0 0 10",key:"svg-0"}],["path",{d:"M13 10h-8m0 4h8",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.21.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ke=w("outline","thumb-up","IconThumbUp",[["path",{d:"M7 11v8a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1v-7a1 1 0 0 1 1 -1h3a4 4 0 0 0 4 -4v-1a2 2 0 0 1 4 0v5h3a2 2 0 0 1 2 2l-1 5a2 3 0 0 1 -2 2h-7a3 3 0 0 1 -3 -3",key:"svg-0"}]]);const Ae=ne(e.jsx("path",{d:"M22 16V4c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2m-11-4 2.03 2.71L16 11l4 5H8zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6z"}),"Collections");function z(a){return G(a,"DD MMM YYYY hh:mm A").format("YYYY-MM-DDTHH:mm:ss.SSS[Z]")}const F=["merchantId","pageNo","limit","customerId","orderType","paymentType","confirmationStatus","status","paymentStatus","branchName","orderId"],Re=a=>{let s={};return a==null||a.forEach(t=>{var r;F!=null&&F.includes(t.id)&&(Array.isArray(t.value)?s[t.id]=(r=t.value)==null?void 0:r.join(","):s[t.id]=t.value)}),s},ze=a=>{var o,c;let s="";const t=(o=a==null?void 0:a[0])==null?void 0:o.id,r=(c=a==null?void 0:a[0])==null?void 0:c.desc;if(t==="customerFirstName"&&!r?s="ascFirstName":t==="customerFirstName"&&r?s="descFirstName":t==="customerLastName"&&!r?s="ascLastName":t==="customerLastName"&&r?s="descLastName":t==="orderDate"&&!r?s="ascOrder":t==="orderDate"&&r&&(s="descOrder"),s)return{sort:s}},Ke=a=>{let s="",t="";const r=a==null?void 0:a.find(o=>o.id==="orderDate");if(r&&Array.isArray(r==null?void 0:r.value)&&(s=r!=null&&r.value[0]?z(r==null?void 0:r.value[0]):"",t=r!=null&&r.value[1]?z(r==null?void 0:r.value[1]):""),s||t)return{startDate:s,endDate:t}};function Ge(a,s,t){const r={merchantId:null,pageNo:t.pageIndex+1,limit:t.pageSize,...ze(s),...Re(a),...Ke(a)};return Y.GET(H.GET_ALL_ORDERS(),{params:r})}const Ye=a=>{const{columnFilters:s,EnableQuery:t,sorting:r,pagination:o}=a;return ue({queryKey:["Orders-Grid-data",s,r,o],queryFn:()=>Ge(s,r,o),placeholderData:J,enabled:t,refetchOnMount:!1,refetchOnWindowFocus:!1,retry:2})},O=({renderedCellValue:a})=>e.jsxs(ce,{sx:{display:"flex",alignItems:"center",gap:"0.5rem",justifyContent:"center"},children:[a==="CASH"&&e.jsx(we,{}),a==="CARD"&&e.jsx(ye,{}),a==="DELIVERY"&&e.jsx(ee,{}),a==="COLLECTION"&&e.jsx(Ae,{}),e.jsx("span",{children:a})]}),He=[{key:"merchantId",name:"merchantId",fieldType:"Number",label:"Merchant ID",disabled:{disabledFieldForNew:!1}},{key:"orderId",name:"orderId",fieldType:"Number",label:"Order ID",disabled:{disabledFieldForNew:!0,disableFieldForEdit:!0}},{key:"orderDate",name:"orderDate",fieldType:"DateTimeRange",label:"Order Date",disabled:{disabledFieldForNew:!1,disableFieldForEdit:!0}},{key:"customerId",name:"customerId",fieldType:"Number",label:"Customer ID",disabled:{disabledFieldForNew:!1}},{key:"customerFirstName",name:"customerFirstName",fieldType:"Text",label:"Customer First Name"},{key:"customerLastName",name:"customerLastName",fieldType:"Text",label:"Customer Last Name"},{key:"orderType",name:"orderType",fieldType:"Select",label:"Order Type",meta:{options:[{label:"DELIVERY",value:"DELIVERY"},{label:"COLLECTION",value:"COLLECTION"}]}},{key:"paymentType",name:"paymentType",fieldType:"Select",label:"Payment Type",meta:{options:[{label:"CASH",value:"CASH"},{label:"CARD",value:"CARD"}]}},{key:"paymentStatus",name:"paymentStatus",fieldType:"Select",label:"Payment Status",meta:{options:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"},{label:"PROCESSED",value:"PROCESSED"}]}},{key:"confirmationStatus",name:"confirmationStatus",fieldType:"Select",label:"Confirmation Status",meta:{options:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"}]}},{key:"promoCode",name:"promoCode",fieldType:"Text",label:"Promo Code"},{key:"promoDiscountSwishr",name:"promoDiscountSwishr",fieldType:"Number",label:"Promo Discount (SWISHR)"},{key:"promoDiscountMerchant",name:"promoDiscountMerchant",fieldType:"Number",label:"Promo Discount (Merchant)"},{key:"refundSwishr",name:"refundSwishr",fieldType:"Number",label:"Refund (SWISHR)"},{key:"refundMerchant",name:"refundMerchant",fieldType:"Number",label:"Refund (Merchant)"},{key:"orderDiscount",name:"orderDiscount",fieldType:"Number",label:"Order Discount"},{key:"driverTip",name:"driverTip",fieldType:"Number",label:"Driver Tip"},{key:"deliveryCharge",name:"deliveryCharge",fieldType:"Number",label:"Delivery Charge"},{key:"serviceFee",name:"serviceFee",fieldType:"Number",label:"Service Fee"},{key:"surcharge",name:"surcharge",fieldType:"Number",label:"Surcharge"},{key:"subTotal",name:"subTotal",fieldType:"Number",label:"Sub Total"},{key:"taxes",name:"taxes",fieldType:"Number",label:"Taxes"},{key:"total",name:"total",fieldType:"Number",label:"Total"},{key:"branchName",name:"branchName",fieldType:"Text",label:"Branch Name"},{key:"status",name:"status",fieldType:"Select",label:"Status",meta:{options:M}}],Ve=()=>{var p,i;const[a,s]=C.useState([]),[t,r]=C.useState([]),[o,c]=C.useState({pageIndex:0,pageSize:10}),[h,{open:u,close:d}]=ae(!1),{data:m,isError:v,isLoading:x}=Ye({columnFilters:a,EnableQuery:!h,sorting:t,pagination:o}),T=C.useMemo(()=>[{accessorKey:"merchantId",header:"Merchant ID",enableSorting:!1,size:150},{accessorKey:"orderId",header:"Order ID",enableSorting:!1,size:150},{accessorKey:"customerId",header:"Customer ID",enableSorting:!1,size:150,enableEditing:!1},{accessorKey:"branchName",header:"Branch Name",enableSorting:!1},{accessorKey:"orderDate",accessorFn:l=>new Date(l.orderDate),header:"Order Date",filterVariant:"datetime-range",Cell:({cell:l})=>{const n=l.getValue();return G(n).format("DD MMM YYYY hh:mm A")},muiFilterDateTimePickerProps:{label:"Order Date",timeSteps:{minutes:1}},maxSize:150},{accessorKey:"customerFirstName",header:"Customer First Name",enableColumnFilter:!1},{accessorKey:"customerLastName",header:"Customer Last Name",enableColumnFilter:!1},{accessorKey:"orderType",header:"Order Type",filterVariant:"multi-select",filterSelectOptions:[{label:"DELIVERY",value:"DELIVERY"},{label:"COLLECTION",value:"COLLECTION"}],enableSorting:!1,maxSize:30,Cell:({renderedCellValue:l})=>O({renderedCellValue:l})},{accessorKey:"paymentType",header:"Payment Type",filterVariant:"multi-select",filterSelectOptions:[{label:"CASH",value:"CASH"},{label:"CARD",value:"CARD"}],enableSorting:!1,maxSize:30,Cell:({renderedCellValue:l})=>O({renderedCellValue:l})},{accessorKey:"paymentStatus",header:"Payment Status",filterVariant:"multi-select",filterSelectOptions:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"},{label:"PROCESSED",value:"PROCESSED"}],enableSorting:!1,maxSize:30},{accessorKey:"confirmationStatus",header:"Confirmation Status",filterVariant:"multi-select",filterSelectOptions:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"}],enableSorting:!1,maxSize:30},{accessorKey:"promoCode",header:"Promo Code",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"promoDiscountSwishr",header:"Promo Discount (SWISHR)",enableSorting:!1,enableColumnFilter:!1,maxSize:50},{accessorKey:"promoDiscountMerchant",header:"Promo Discount (Merchant)",enableSorting:!1,enableColumnFilter:!1,maxSize:50},{accessorKey:"refundSwishr",header:"Refund (SWISHR)",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"refundMerchant",header:"Refund (Merchant)",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"orderDiscount",header:"Order Discount",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"driverTip",header:"Driver Tip",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"deliveryCharge",header:"Delivery Charge",filterVariant:"range-slider",enableSorting:!1,enableColumnFilter:!1,maxSize:30,Cell:({renderedCellValue:l})=>O({renderedCellValue:l})},{accessorKey:"serviceFee",header:"Service Fee",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"surcharge",header:"Surcharge",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"subTotal",header:"Sub Total",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"taxes",header:"Taxes",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"total",header:"Total",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"status",header:"Status",maxSize:30,Cell:({cell:l})=>{var n,f;return e.jsx(pe,{value:((f=(n=M)==null?void 0:n.find(D=>D.value===l.getValue()))==null?void 0:f.label)??""})},filterVariant:"multi-select",enableSorting:!1,filterSelectOptions:M,editSelectOptions:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"}]},{accessorKey:"orderItems",header:"Order Items",enableSorting:!1}],[]);return e.jsx(de,{children:e.jsx(me,{data:((p=m==null?void 0:m.data)==null?void 0:p.orders)??[],columnFilters:a,columns:T,pagination:o,sorting:t,totalRowCount:((i=m==null?void 0:m.data)==null?void 0:i.totalCount)??0,onColumnFiltersChange:s,onPaginationChange:c,onSortingChange:r,isLoading:x,OnFilterButtonClicked:()=>u(),OnApplyFiltersClicked:()=>d(),filterDrawerIsOpen:h,enableRowSelection:!0,isError:v,tableName:"OrdersDisplay",columnPinning:{left:["mrt-row-select","mrt-row-actions","orderId","customerId","branchName"],right:["status"]},crudOperationHeader:"Order",uniqueIDForRows:"orderID",uiSchema:He})})},Ue=({maxSize:a=5*1024**2,maxFiles:s=10,acceptedTypes:t=[N.csv,N.xlsx,N.xls],onDrop:r,onReject:o,uploadedFiles:c=[],onDeleteFile:h,dropzoneText:u={title:"Drag your files here",description:"Attach multiple files. Each file should not exceed 5 MB, and the total file count should not exceed 10.",rejectMessage:"File format not allowed"}})=>e.jsx(E,{onDrop:r,onReject:o,maxSize:a,maxFiles:s,accept:t,style:{display:"flex",alignItems:"center",marginTop:"20px"},children:e.jsxs(P,{justify:"center",gap:"xl",children:[e.jsx(E.Accept,{children:e.jsx(he,{style:{width:S(52),height:S(52),color:"var(--mantine-color-blue-6)"},stroke:1.5})}),e.jsxs(E.Reject,{children:[e.jsx(De,{style:{width:S(52),height:S(52),color:"var(--mantine-color-red-6)"},stroke:1.5}),u.rejectMessage]}),e.jsx(E.Idle,{children:e.jsx(fe,{style:{width:S(52),height:S(52),color:"var(--mantine-color-dimmed)"},stroke:1.5})}),e.jsxs("div",{children:[e.jsx(g,{size:"xl",inline:!0,children:u.title}),e.jsx(g,{size:"sm",c:"dimmed",inline:!0,mt:7,children:u.description}),c.length>0&&e.jsx("div",{style:{marginTop:10,color:"green"},children:e.jsx(R,{spacing:"xs",size:"sm",style:{pointerEvents:"all"},center:!0,icon:e.jsx(be,{color:"teal",size:24,radius:"xl",children:e.jsx(Se,{style:{width:S(16),height:S(16)}})}),children:c.map(d=>e.jsx(R.Item,{children:e.jsxs(P,{align:"center",children:[e.jsx(K,{children:d.name}),h&&e.jsx(re,{onClick:m=>{m.stopPropagation(),h(d.name)},style:{pointerEvents:"all"},variant:"transparent",color:"green",children:e.jsx(Ce,{})},d.name)]})},d.name+`${d.size}`))})})]})]})}),Be=async a=>{const s=new FormData;return a.csvfile.forEach(t=>{s.append("files",t)}),await Y.POST(H.UPLOAD_AND_PARSE_DOCUMENT(),s)},We=()=>Ee({mutationFn:Be}),_e=({response:a})=>{const s=L();return a?e.jsxs(Ne,{padding:"lg",radius:"md",withBorder:!0,children:[e.jsx(Fe,{icon:e.jsx(Le,{size:16}),title:"Error",color:"red",radius:"md",variant:"outline",mb:"lg",p:"sm",children:a.error}),e.jsxs(se,{children:[e.jsx(Oe,{order:5,mb:"md",styles:{root:{color:s.colors.gray[7]}},children:"Details:"}),e.jsxs(b,{withRowBorders:!0,withTableBorder:!0,withColumnBorders:!0,striped:!0,children:[e.jsx(b.Thead,{children:e.jsxs(b.Tr,{children:[e.jsx(b.Th,{styles:{th:{color:s.colors.gray[7]}},children:"File Name"}),e.jsx(b.Th,{styles:{th:{color:s.colors.gray[7]}},children:"Error"})]})}),e.jsx(b.Tbody,{children:a.errors.map((t,r)=>e.jsxs(b.Tr,{children:[e.jsx(b.Td,{children:e.jsx(g,{children:t.fileName})}),e.jsx(b.Td,{children:e.jsx(g,{style:{color:"red"},children:t.Error})})]},t.fileName+r))})]})]})]}):null},qe=xe({csvfile:Te().min(1,"You must upload at least one file.").required("CSV file is required.")}),Qe=()=>{var x,T;const a={csvfile:[]},s=C.useRef(null),{mutate:t,error:r,reset:o,isPending:c}=We(),[h,u]=te.useState(!1),d=L(),m=le(),v=p=>{t({csvfile:p.csvfile},{onSuccess:i=>{var l,n;I.show({title:"Success",message:((l=i.data)==null?void 0:l.message)||"File uploaded successfully.",color:"green",position:"top-center",withCloseButton:!0,autoClose:!0}),(n=s.current)==null||n.resetForm(),m.invalidateQueries({queryKey:["Orders-Grid-data"]}),u(!0)},onError:i=>{var l,n,f;I.show({title:"Error",message:((n=(l=i.response)==null?void 0:l.data)==null?void 0:n.message)||"Failed to upload files.",color:"red"}),(f=s.current)==null||f.setErrors(i),u(!1)}})};return e.jsx(oe,{shadow:"sm",p:20,children:e.jsxs(je,{gap:20,pos:"relative",children:[e.jsx(g,{size:"lg",style:{fontWeight:"600"},children:"Upload Excel or CSV file to store order details. (Multiple files can be uploaded)"}),e.jsx(ge,{initialValues:a,validationSchema:qe,onSubmit:v,innerRef:s,onReset:()=>o(),children:({values:p,errors:i,touched:l,setFieldValue:n})=>{const f=y=>{n("csvfile",[...p.csvfile,...y])},D=y=>{I.show({title:"Invalid Files",message:"Some files were rejected due to invalid format.",color:"red"}),console.error("Rejected files:",y)},j=y=>{const U=p.csvfile.filter(B=>B.name!==y);n("csvfile",U),o()};return e.jsxs(ve,{children:[e.jsx(Ue,{onDrop:f,onReject:D,uploadedFiles:p.csvfile,onDeleteFile:j,dropzoneText:{title:"Upload files with relevant data",description:"You can upload at max 10 files with size not exceeding 5 MB",rejectMessage:"Invalid file type. Only CSV files are allowed."},maxFiles:10}),(i==null?void 0:i.csvfile)&&(l==null?void 0:l.csvfile)&&e.jsx("div",{style:{color:"red",marginTop:"10px"},children:i==null?void 0:i.csvfile}),e.jsxs(P,{mt:"md",justify:"center",children:[e.jsx(A,{type:"submit",loading:!1,children:"Submit"}),e.jsx(A,{type:"reset",variant:"outline",children:"Reset"})]})]})}}),e.jsx(Ie,{visible:c,zIndex:1e3,overlayProps:{radius:"sm",blur:2}}),((x=s.current)==null?void 0:x.errors)&&e.jsx(_e,{response:(T=r==null?void 0:r.response)==null?void 0:T.data}),h&&e.jsxs(k,{direction:"column",align:"center",mt:"10px",children:[e.jsx(ke,{stroke:2,size:40,color:d.colors.green[6]}),e.jsxs(g,{size:"lg",style:{fontWeight:"600",color:d.colors.gray[7],textAlign:"center"},children:[" ",'Orders are saved successfully. You can see uploaded orders by switching tab to "All Orders".']})]})]})})};function ma(){const a=[{label:"All Orders",value:"All_Orders",content:e.jsx(Ve,{})},{label:"Upload Files",value:"Upload_Files",content:e.jsx(Qe,{})}];return e.jsx(ie,{tabs:a})}export{ma as default};
